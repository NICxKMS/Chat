"use strict";(self.webpackChunkai_chat_interface=self.webpackChunkai_chat_interface||[]).push([[9823],{10784:(e,s,t)=>{t.d(s,{n:()=>r});var a=t(9950),n=t(29937);const r=e=>{const s=`profilePicture_${e}`,[t,r]=(0,n.M)(s,null),[l,i]=(0,a.useState)(null),[o,c]=(0,a.useState)(!1),[m,u]=(0,a.useState)(null);return(0,a.useEffect)((()=>{let s=!0;if(!e)return i(null),void c(!1);let a=t;if(a){if("string"==typeof a){const e={data:a,timestamp:Date.now()};r(e),a=e}if(a.timestamp&&Date.now()-a.timestamp<864e5&&a.data)return i(a.data),void c(!1);r(null)}return c(!0),fetch(e).then((e=>{if(!e.ok)throw new Error(`Failed to fetch image: ${e.status}`);return e.blob()})).then((e=>new Promise(((s,t)=>{const a=new FileReader;a.onloadend=()=>s(a.result),a.onerror=t,a.readAsDataURL(e)})))).then((e=>{if(!s)return;const t={data:e,timestamp:Date.now()};r(t),i(e)})).catch((e=>{s&&u(e)})).finally((()=>{s&&c(!1)})),()=>{s=!1}}),[e,t,r]),{profilePicture:l,loading:o,error:m}}},19676:(e,s,t)=>{t.d(s,{rP:()=>a});const a=e=>{if("string"!=typeof e||""===e)return"";const s=new RegExp("(```[\\s\\S]*?```)|^(\\s*)\\\\\\[([\\s\\S]*?)\\\\\\](.*)|^(\\s*)\\[\\\\/([\\s\\S]*?)\\\\/](.*)|\\\\\\(\\s*(.*?)\\s*\\\\\\)","gm");let t=e.replace(s,((e,s,t,a,n,r,l,i,o)=>void 0!==s?s:void 0!==t?`${t}$$${a}$$`:void 0!==r?`${r}$$${l}$$`:void 0!==o?`$${o.trim()}$`:e));return t=t.replace(/\n{3,}/g,"\n\n"),t=t.replace(/\n{3,}/g,"\n\n"),t}},27871:(e,s,t)=>{t.r(s),t.d(s,{default:()=>A});var a=t(9950),n=t(20690),r=t(83406),l=t(80333),i=t(53562);function o(e){return e?e<1e3?`${e}ms`:`${(e/1e3).toFixed(1)}s`:"0.0s"}var c=t(19676),m=t(44414);function u(e){let{children:s,components:n={}}=e;const[r,l]=(0,a.useState)(null);if((0,a.useEffect)((()=>{let e=!1;return Promise.all([Promise.all([t.e(5764),t.e(2042),t.e(4370),t.e(1042),t.e(4912),t.e(4910),t.e(268),t.e(496),t.e(8360),t.e(4377),t.e(8467),t.e(4999),t.e(9063),t.e(8018),t.e(6327),t.e(2244),t.e(7742),t.e(5462)]).then(t.bind(t,31815)),Promise.all([t.e(5764),t.e(2042),t.e(4370),t.e(1042),t.e(4912),t.e(4910),t.e(5419),t.e(3542),t.e(4644),t.e(6376),t.e(8683),t.e(494),t.e(8920),t.e(4688)]).then(t.bind(t,7849)),Promise.all([t.e(5764),t.e(8482),t.e(5418),t.e(1700),t.e(1591),t.e(9686)]).then(t.bind(t,97955)),Promise.all([t.e(5764),t.e(5419),t.e(4899),t.e(6422)]).then(t.bind(t,79213)),Promise.all([t.e(4314),t.e(9959),t.e(6716),t.e(8990),t.e(9544),t.e(1591),t.e(3064)]).then(t.bind(t,41665))]).then((s=>{let[a,n,r,i,o]=s;e||(Promise.all([t.e(4314),t.e(9959)]).then(t.bind(t,86470)),l({Markdown:a.default,remarkPlugins:[n.default,r.default,i.default],rehypePlugins:[o.default]}))})).catch((e=>{})),()=>{e=!0}}),[]),!r)return null;const{Markdown:i,remarkPlugins:o,rehypePlugins:c}=r;return(0,m.jsx)(a.Suspense,{fallback:null,children:(0,m.jsx)(i,{remarkPlugins:o,rehypePlugins:c,components:n,skipHtml:!1,children:s})})}const d=(0,a.lazy)((()=>Promise.all([t.e(5764),t.e(4314),t.e(9959),t.e(2412),t.e(6017),t.e(399),t.e(4917),t.e(7777),t.e(5128),t.e(438),t.e(662),t.e(3887),t.e(2042),t.e(4370),t.e(1042),t.e(4912),t.e(4910),t.e(5419),t.e(268),t.e(496),t.e(6716),t.e(8990),t.e(8360),t.e(4377),t.e(8482),t.e(5418),t.e(4734),t.e(6755),t.e(1184),t.e(5132),t.e(4582),t.e(8162),t.e(4092),t.e(1217),t.e(822),t.e(9331),t.e(4335),t.e(8184),t.e(5522),t.e(3300),t.e(5080),t.e(1927),t.e(3690),t.e(8476),t.e(8747),t.e(1262),t.e(4120),t.e(7295),t.e(9948),t.e(4621),t.e(2812),t.e(9889),t.e(392),t.e(1250),t.e(1878),t.e(6327),t.e(2244),t.e(7742),t.e(5462),t.e(494),t.e(8920),t.e(9399),t.e(1637),t.e(3754),t.e(6968),t.e(7945),t.e(8388),t.e(2693),t.e(3051),t.e(8077),t.e(566),t.e(2117),t.e(6493),t.e(9579)]).then(t.bind(t,35404))));let g;const h=e=>{let{message:s,isStreaming:n=!1,onEditMessage:r=null,overrideContent:h=null,avatarUrl:_=null}=e;const p=null!=h?h:s.content,[M,x]=(0,a.useState)(!1),C=(0,a.useMemo)((()=>"assistant"===s.role?p:(0,c.rP)(p)),[p,s.role]),[f,A]=(0,a.useState)(C);(0,a.useEffect)((()=>{A(C)}),[C]),(0,a.useEffect)((()=>{if("assistant"!==s.role||"string"!=typeof p||"undefined"==typeof Worker)return;const e=s.timestamp,a=("undefined"==typeof Worker||g||(g=new Worker(new URL(t.p+t.u(4606),t.b),{type:void 0})),g),n=s=>{s.data.id===e&&(s.data.success?A(s.data.data):A(p))};return a.addEventListener("message",n),a.postMessage({id:e,content:p}),()=>{a.removeEventListener("message",n)}}),[p,s.role,s.timestamp]);const j=(0,a.useMemo)((()=>{switch(s.role){case"user":return _?(0,m.jsx)("img",{src:_,alt:"User avatar",className:i.A.ChatMessage__avatarImg}):null;case"assistant":return(0,m.jsx)(l.MiJ,{size:16,className:i.A.ChatMessage__icon});case"system":return(0,m.jsx)(l.L64,{size:16,className:i.A.ChatMessage__icon});case"error":return(0,m.jsx)(l._0O,{size:16,className:i.A.ChatMessage__icon});default:return null}}),[s.role,_]),v=(0,a.useMemo)((()=>{switch(s.role){case"user":return i.A["ChatMessage--user"];case"assistant":return i.A["ChatMessage--assistant"];case"system":return i.A["ChatMessage--system"];case"error":return i.A["ChatMessage--error"];default:return""}}),[s.role]),N=(0,a.useMemo)((()=>!("assistant"!==s.role||!s.metrics)),[s.role,s.metrics]),k=(0,a.useCallback)((()=>{const e="string"==typeof s.content?s.content:Array.isArray(s.content)?s.content.filter((e=>"text"===e.type)).map((e=>e.text)).join("\n"):"";navigator.clipboard.writeText(e).then((()=>{x(!0),setTimeout((()=>x(!1)),2e3)}))}),[s.content]),y=(0,a.useMemo)((()=>(0,m.jsx)("button",{className:`${i.A.ChatMessage__copyMessageButton} ${"assistant"===s.role&&N?i.A.ChatMessage__copyMessageButtonInMetrics:i.A.ChatMessage__copyMessageButtonBottomRight}`,onClick:k,"aria-label":"Copy message",title:"Copy message",children:M?(0,m.jsx)(l.Srz,{size:16}):(0,m.jsx)(l.TdU,{size:16})})),[k,s.role,N,M]),$=(0,a.useCallback)((()=>{r&&r(s)}),[r,s]),b=(0,a.useMemo)((()=>"user"===s.role?(0,m.jsx)("button",{className:i.A.ChatMessage__editMessageButton,onClick:$,"aria-label":"Edit message",title:"Edit message",children:(0,m.jsx)(l.R2l,{size:16})}):null),[s.role,$]);return(0,m.jsxs)("div",{className:i.A.ChatMessage+" "+v,children:[(0,m.jsxs)("div",{className:i.A.ChatMessage__body,children:[j&&(0,m.jsx)("div",{className:i.A.ChatMessage__avatar,children:j}),(0,m.jsxs)("div",{className:i.A.ChatMessage__contentWrapper,children:[(0,m.jsx)(a.Suspense,{fallback:null,children:(0,m.jsx)("div",{className:i.A.ChatMessage__content,children:"assistant"===s.role?(0,m.jsx)(d,{content:f,isStreaming:n}):(0,m.jsx)(u,{children:f})})}),"assistant"===s.role&&(()=>{if(!N||!s.metrics)return null;const e=n,{elapsedTime:t,tokenCount:a,tokensPerSecond:r,timeToFirstToken:c,promptTokens:u,completionTokens:d,totalTokens:g,finishReason:h}=s.metrics;return null!=t||null!=a||null!=r||null!=c||null!=u||null!=d||null!=g||null!=h?(0,m.jsxs)("div",{className:i.A.ChatMessage__metricsContainer,children:[null!=c&&0!==c&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.O4,{size:14,className:i.A.ChatMessage__metricIcon}),"First Token: ",o(c)]}),null!=t&&0!==t&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.O4,{size:14,className:i.A.ChatMessage__metricIcon}),"Total Time: ",o(t)]}),null!=a&&0!==a&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Tokens: ",a]}),null!=u&&0!==u&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Prompt: ",u]}),null!=d&&0!==d&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Completion: ",d]}),null!=g&&0!==g&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.MiJ,{size:14,className:i.A.ChatMessage__metricIcon}),"Total: ",g]}),null!=r&&0!==r&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l.BHx,{size:14,className:i.A.ChatMessage__metricIcon}),"Speed: ",r," t/s"]}),null!=h&&""!==h&&"stop"!==h.toLowerCase()&&"unknown"!==h.toLowerCase()&&(0,m.jsxs)("span",{className:i.A.ChatMessage__metric,children:[(0,m.jsx)(l._0O,{size:14,className:i.A.ChatMessage__metricIcon}),h]}),e&&(0,m.jsxs)("span",{className:`${i.A.ChatMessage__metric} ${i.A.ChatMessage__generatingIndicator}`,children:[(0,m.jsx)("span",{className:i.A.ChatMessage__generatingDot}),"Generating..."]}),y]}):null})(),"user"!==s.role&&("assistant"!==s.role||!N)&&y]})]}),"user"===s.role&&(0,m.jsxs)("div",{className:i.A.ChatMessage__actions,children:[b,y]})]})};h.displayName="ChatMessage";const _=(0,a.memo)(h);var p=t(17119),M=t(96513);const x=e=>{let{src:s,alt:t,onClose:a}=e;if(!s)return null;const n=(0,m.jsx)("div",{className:M.A.ImageOverlay,onClick:a,role:"dialog","aria-modal":"true",title:"Click to close image",children:(0,m.jsx)("img",{src:s,alt:t,className:M.A.ImageOverlay__image,onClick:e=>{e.stopPropagation()}})});return p.createPortal(n,document.body)};var C=t(10784);const f=(0,a.forwardRef)(((e,s)=>{let{messages:l,error:i,onEditMessage:o}=e;const{isWaitingForResponse:c}=(0,r.P)(),[u,d]=(0,a.useState)(null),{profilePicture:g}=(0,C.n)(u),[h,p]=(0,a.useState)((()=>localStorage.getItem("idToken"))),[M,f]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(!h)return;let e;return(async()=>{const{getFirebaseAuth:s}=await Promise.all([t.e(3424),t.e(7915),t.e(7783),t.e(2702),t.e(961),t.e(3815),t.e(8507)]).then(t.bind(t,82410)),{onAuthStateChanged:a}=await Promise.all([t.e(3424),t.e(7915),t.e(7783),t.e(2702),t.e(961),t.e(3815),t.e(2991)]).then(t.bind(t,57089)),n=s();n&&(e=a(n,(async e=>{if(e){d(e.photoURL||null);try{const s=await e.getIdToken();p(s)}catch{p(null)}}else d(null),p(null)})))})(),()=>{e&&e()}}),[h]);const A=(0,a.useMemo)((()=>{const e=[...l];if(i){const s=Date.now();e.push({id:s,role:"error",content:i,timestamp:s})}return e}),[l,i]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:n.A.MessageList,ref:s,"aria-live":"polite","aria-relevant":"additions text",children:A.map(((e,s)=>{var t;const a=s===A.length-1,r="assistant"===e.role&&a&&c&&!(null!==(t=e.metrics)&&void 0!==t&&t.isComplete),{images:l,text:i}=function(e){if(!e)return{images:[],text:e};if(Array.isArray(e)){const{images:s,texts:t}=e.reduce(((e,s)=>("image_url"===s.type?e.images.push({url:s.image_url.url,alt:s.image_url.alt||s.alt||null}):"text"===s.type&&e.texts.push(s.text),e)),{images:[],texts:[]});return{images:s,text:t.join(" ")}}return{images:[],text:e}}(e.content),d=e.timestamp?`${e.role}-${e.timestamp}-${s}`:`${e.role}-${s}`;return(0,m.jsxs)("div",{className:n.A.MessageList__messageRow,children:["user"===e.role&&l.length>0&&(0,m.jsx)("div",{className:n.A.MessageList__imageContainer,children:l.map(((e,s)=>(0,m.jsx)("img",{src:e.url,alt:e.alt||`Uploaded image ${s+1}`,className:`${n.A.MessageList__messageImage} ${n.A.MessageList__clickableImage}`,onClick:()=>{return s=e.url,void f(s);var s}},`${d}-img-${s}`)))}),(i||"user"!==e.role)&&(0,m.jsx)(_,{message:e,overrideContent:i||void 0,isStreaming:r,onEditMessage:"user"===e.role?o:void 0,avatarUrl:"user"===e.role&&h?g||u:void 0})]},d)}))}),M&&(0,m.jsx)(x,{src:M,alt:"Image preview",onClose:()=>{f(null)}})]})}));f.displayName="MessageList";const A=(0,a.memo)(f)}}]);